from aiogram import Bot, Dispatcher
from aiogram.filters import Command
from aiogram.types import Message
import asyncio
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from apscheduler.triggers.cron import CronTrigger
import random
import os
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()
TOKEN = os.getenv("BOT_TOKEN")
CHAT_ID = os.getenv("CHAT_ID")

bot = Bot(token=TOKEN)
dp = Dispatcher()

# –°–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π
names = ["–ê–Ω–∞—Å—Ç–∞—Å–∏—è", "–ù–∞—Å—Ç–µ–Ω–∞", "–ù–∞—Å—Ç–µ–Ω—å–∫–∞", "–¥–µ–≤–æ—á–∫–∞ –º–æ—è", "—è–≥–æ–¥–∫–∞ –º–æ—è", "–±–æ–≥–∏–Ω—è –º–æ—è", "–∫–æ—Ä–æ–ª–µ–≤–∞"]

# –°–ø–∏—Å–æ–∫ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –∏ —Å—Ç—Ä–∞—Å—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
romantic_messages = [
    "—Ç—ã, –∫–∞–∫ –≤–æ—Å—Ö–æ–¥ —Å–æ–ª–Ω—Ü–∞ –Ω–∞–¥ –º–æ—Ä–µ–º, –ø—Ä–∏–Ω–æ—Å–∏—à—å —Å–≤–µ—Ç –∏ —Ç–µ–ø–ª–æ. üåÖ",
    "—Ç–≤–æ–∏ –≥–ª–∞–∑–∞ ‚Äî –≥–ª—É–±–æ–∫–∏–π –æ–∫–µ–∞–Ω —Å—Ç—Ä–∞—Å—Ç–∏ –∏ —Ç–∞–π–Ω—ã. üåä",
    "—Ç—ã –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∏ —Å–µ–∫—Å—É–∞–ª—å–Ω–∞—è, –∫–∞–∫ –ª–µ—Ç–Ω—è—è –Ω–æ—á—å, –ø–æ–ª–Ω–∞—è —Ç–∞–π–Ω. üåô",
    "—Ç–≤–æ–∏ –≥—É–±—ã ‚Äî —Å–ª–æ–≤–Ω–æ —Å–ª–∞–¥–∫–∏–π –º—ë–¥, –æ–Ω–∏ –º–∞–Ω—è—Ç –∏ —Å–≤–æ–¥—è—Ç —Å —É–º–∞. üíã",
    "—Ç—ã ‚Äî –≤–æ–ª—à–µ–±—Å—Ç–≤–æ –≤ —á–∏—Å—Ç–æ–º –≤–∏–¥–µ, —Ç–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –Ω–∞–ø–æ–ª–Ω—è–µ—Ç –º–∏—Ä —Å–∏—è–Ω–∏–µ–º. ‚ú®",
    "—Ç–≤–æ—è —É–ª—ã–±–∫–∞ ‚Äî –∫–∞–∫ —Ç—ë–ø–ª—ã–π —Å–æ–ª–Ω–µ—á–Ω—ã–π –ª—É—á, –∫–æ—Ç–æ—Ä—ã–π –≥—Ä–µ–µ—Ç –º–æ—é –¥—É—à—É. ‚òÄÔ∏è",
    "—Ç–≤–æ—è –≥—Ä–∞—Ü–∏—è –∏ —à–∞—Ä–º –æ—Å—Ç–∞–≤–ª—è—é—Ç –Ω–µ–∏–∑–≥–ª–∞–¥–∏–º—ã–π —Å–ª–µ–¥ –≤ —Å–µ—Ä–¥—Ü–∞—Ö. ‚ù§Ô∏è",
    "–º–æ–∏ –º—ã—Å–ª–∏ –æ —Ç–µ–±–µ ‚Äî —Å–ª–∞–¥–∫–∏–π –æ–≥–æ–Ω—å, –∫–æ—Ç–æ—Ä—ã–π —è –Ω–µ —Ö–æ—á—É —Ç—É—à–∏—Ç—å. üî•",
    "—Ç–≤–æ–∏ –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è ‚Äî –∫–∞–∫ —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ, –ø—Ä–æ–±–µ–≥–∞—é—â–µ–µ –ø–æ –∫–æ–∂–µ. ‚ö°",
    "—è –±—ã —Ä–∞—Å—Ç–≤–æ—Ä–∏–ª—Å—è –≤ —Ç–µ–±–µ, –∫–∞–∫ –Ω–æ—á–Ω–æ–µ –Ω–µ–±–æ –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏ –∑–≤—ë–∑–¥. üåå",
    "—Ç–≤–æ–∏ —Å–ª–æ–≤–∞ ‚Äî —ç—Ç–æ –º—É–∑—ã–∫–∞, –º–µ–ª–æ–¥–∏—è, —á—Ç–æ –∏–≥—Ä–∞–µ—Ç –≤ –º–æ—ë–º —Å–µ—Ä–¥—Ü–µ. üé∂",
    "–µ—Å–ª–∏ –±—ã –ª—é–±–æ–≤—å –±—ã–ª–∞ —Å—Ç–∏—Ö–∏–µ–π, —Ç—ã –±—ã–ª–∞ –±—ã –±—É—Ä–µ–π, –∑–∞–≤–æ—Ä–∞–∂–∏–≤–∞—é—â–µ–π —Å–≤–æ–µ–π –º–æ—â—å—é. üå™Ô∏è",
    "—Ç–≤–æ–∏ –≥—É–±—ã ‚Äî –≤—Ä–∞—Ç–∞ –∫ –Ω–∞—Å–ª–∞–∂–¥–µ–Ω–∏—é, –∫–æ—Ç–æ—Ä—ã–º —è –±—ã –Ω–∞—Å–ª–∞–∂–¥–∞–ª—Å—è –≤–µ—á–Ω–æ. üî•",
    "—Ç—ã ‚Äî –º–∞–≥–∏—è, –∫–æ—Ç–æ—Ä—É—é –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å, –Ω–æ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª—è—Ç—å—Å—è. ü™Ñ",
    "—Ç–≤–æ–π –≥–æ–ª–æ—Å ‚Äî –∫–∞–∫ —à–µ–ª–µ—Å—Ç –ª–∏—Å—Ç—å–µ–≤ –≤ —Ç—ë–ø–ª—É—é –Ω–æ—á—å, —É–±–∞—é–∫–∏–≤–∞—é—â–∏–π –∏ —á–∞—Ä—É—é—â–∏–π. üçÉ",
]

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–±—Ä–∞—â–µ–Ω–∏–µ–º
async def send_romantic_message():
    if CHAT_ID:
        name = random.choice(names)  # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ
        message = f"{name}, {random.choice(romantic_messages)}"  # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞—â–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª–æ
        await bot.send_message(CHAT_ID, message)
    else:
        print("Chat ID –Ω–µ –∑–∞–¥–∞–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã /setchat.")

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ —Å –≥—Ä–∞—Ñ–∏–∫–æ–º 05:00 - 21:00 (–ø–æ –ú–°–ö)
async def start_scheduler():
    scheduler = AsyncIOScheduler(timezone="Europe/Moscow")
    scheduler.add_job(send_romantic_message, CronTrigger(hour="5-21", minute=0))  # –ö–∞–∂–¥–æ–µ –Ω–∞—á–∞–ª–æ —á–∞—Å–∞
    scheduler.start()

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
@dp.message(Command("start"))
async def start_command(message: Message):
    await message.reply("–ü—Ä–∏–≤–µ—Ç, –º–æ—è –≤–æ–ª—à–µ–±–Ω–∏—Ü–∞! ‚ú® –¢–µ–ø–µ—Ä—å —è –±—É–¥—É –ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ç–µ–±–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ –∏ —Å—Ç—Ä–∞—Å—Ç–Ω—ã–µ –ø–æ—Å–ª–∞–Ω–∏—è –∫–∞–∂–¥—ã–π —á–∞—Å —Å 05:00 –¥–æ 21:00! üíñ")

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ chat_id
@dp.message(Command("setchat"))
async def set_chat_id(message: Message):
    global CHAT_ID
    CHAT_ID = message.chat.id
    with open('.env', 'a') as f:
        f.write(f"\nCHAT_ID={CHAT_ID}")
    await message.reply("Chat ID —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –¢–µ–ø–µ—Ä—å —è –±—É–¥—É –ø—Ä–∏—Å—ã–ª–∞—Ç—å —Ç–µ–±–µ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è. üíñ")

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
async def main():
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω...")
    
    # –ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
    await start_scheduler()
    
    # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
